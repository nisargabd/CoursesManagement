<div class="course-form-wrapper">

  <!-- HEADER -->
  <div class="cf-header">
    <div class="cf-header-left">
      <button mat-button class="cf-back-btn" (click)="onCancel()">
        <mat-icon>arrow_back</mat-icon>
        Back to Courses
      </button>
    </div>

    <h1 class="cf-title">
      {{ pageTitle }}
    </h1>
  </div>

  <mat-card class="cf-card">

   <form [formGroup]="courseForm" (ngSubmit)="onSubmit()">

  <!-- SECTION: CORE FIELDS -->
  <div class="cf-section">

    <!-- Course Name -->
    <div class="cf-field">
      <label><mat-icon>book</mat-icon> Course Name <span>*</span></label>

      <mat-form-field appearance="outline" class="cf-mat-field">
        <input matInput formControlName="name" maxlength="30">

        <!-- character counter -->
        <mat-hint align="end">
          {{ courseForm.get('name')?.value?.length || 0 }}/30
        </mat-hint>

        <!-- errors -->
        <mat-error *ngIf="courseForm.get('name')?.hasError('required')">
          Course name is required
        </mat-error>
        <mat-error *ngIf="courseForm.get('name')?.hasError('minlength')">
          Minimum 3 characters required
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Description -->
    <div class="cf-field">
      <label><mat-icon>description</mat-icon> Description <span>*</span></label>

      <mat-form-field appearance="outline" class="cf-mat-field">
        <textarea matInput formControlName="description" maxlength="100"></textarea>

        <!-- character counter -->
        <mat-hint align="end">
          {{ courseForm.get('description')?.value?.length || 0 }}/100
        </mat-hint>

        <!-- errors -->
        <mat-error *ngIf="courseForm.get('description')?.hasError('required')">
          Description is required
        </mat-error>
        <mat-error *ngIf="courseForm.get('description')?.hasError('minlength')">
          Minimum 10 characters required
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Board -->
    <div class="cf-field">
      <label><mat-icon>account_balance</mat-icon> Board <span>*</span></label>

      <mat-form-field appearance="outline" class="cf-mat-field">
        <mat-select formControlName="board">
          <mat-option *ngFor="let b of boardOptions" [value]="b">
            {{ b }}
          </mat-option>
        </mat-select>

        <!-- errors -->
        <mat-error *ngIf="courseForm.get('board')?.hasError('required')">
          Board selection is required
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Medium -->
    <div class="cf-field">
      <label><mat-icon>language</mat-icon> Medium <span>*</span></label>

      <mat-form-field appearance="outline" class="cf-mat-field">
        <mat-select formControlName="medium" multiple>
          <mat-option *ngFor="let m of mediumOptions" [value]="m">
            {{ m }}
          </mat-option>
        </mat-select>

        <!-- errors -->
        <mat-error *ngIf="courseForm.get('medium')?.hasError('required')">
          Select at least 1 medium
        </mat-error>
        <mat-error *ngIf="courseForm.get('medium')?.hasError('maxlength')">
          You can select up to 3 mediums only
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Grade -->
    <div class="cf-field">
      <label><mat-icon>school</mat-icon> Grade <span>*</span></label>

      <mat-form-field appearance="outline" class="cf-mat-field">
        <mat-select formControlName="grade" multiple>
          <mat-option *ngFor="let g of gradeOptions" [value]="g">
            Grade {{ g }}
          </mat-option>
        </mat-select>

        <!-- errors -->
        <mat-error *ngIf="courseForm.get('grade')?.hasError('required')">
          Select at least 1 grade
        </mat-error>
        <mat-error *ngIf="courseForm.get('grade')?.hasError('maxlength')">
          You can choose up to 5 grades only
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Subject -->
    <div class="cf-field">
      <label><mat-icon>class</mat-icon> Subject <span>*</span></label>

      <mat-form-field appearance="outline" class="cf-mat-field">
        <mat-select formControlName="subject" multiple>
          <mat-option *ngFor="let s of subjectOptions" [value]="s">
            {{ s }}
          </mat-option>
        </mat-select>

        <!-- errors -->
        <mat-error *ngIf="courseForm.get('subject')?.hasError('required')">
          Select at least 1 subject
        </mat-error>
        <mat-error *ngIf="courseForm.get('subject')?.hasError('maxlength')">
          Maximum 3 subjects allowed
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Status (Admin only) -->
    <ng-container *ngIf="$any(authService).isAdmin()">
      <div class="cf-field">
        <label><mat-icon>visibility</mat-icon> Status <span>*</span></label>

        <mat-form-field appearance="outline" class="cf-mat-field">
          <mat-select formControlName="status">
            <mat-option value="live">Live</mat-option>
            <mat-option value="draft">Draft</mat-option>
          </mat-select>

          <mat-error *ngIf="courseForm.get('status')?.hasError('required')">
            Status is required
          </mat-error>
        </mat-form-field>
      </div>
    </ng-container>

  </div>

  <!-- SECTION: UNITS -->
  <div class="cf-units-box">
    <div class="cf-units-header">
      <h2><mat-icon>menu_book</mat-icon> Units</h2>
      <button mat-raised-button color="primary" type="button" (click)="openAddUnitDialog()">
        Add Unit
      </button>
    </div>

    <!-- Select Units -->
    <mat-form-field appearance="outline" class="cf-mat-field" *ngIf="availableUnits.length > 0">
      <mat-select multiple [(value)]="selectedUnits">
        <mat-option *ngFor="let unit of availableUnits" [value]="unit.id">
          {{ unit.title }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- No units message -->
    <div *ngIf="availableUnits.length === 0" class="cf-no-units">
      <mat-icon>info</mat-icon>
      No units available.
    </div>
  </div>

  <!-- ACTION BUTTONS -->
  <div class="cf-actions">
    <button mat-stroked-button type="button" (click)="onCancel()">Cancel</button>
    <button mat-raised-button color="primary" type="submit" [disabled]="isSubmitting || !courseForm.valid">
      {{ isSubmitting ? 'Savingâ€¦' : submitButtonText }}
    </button>
  </div>

</form>


  </mat-card>

</div>
